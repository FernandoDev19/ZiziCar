<!-- <div class="w-full flex p-3 mb-3">
  <div class="border text-center bg-gray-100 text-gray-600 rounded-l px-4 py-3">
    <fa-icon [icon]="faSearch"></fa-icon>
  </div>
  <input type="text" placeholder="Buscar..." class="border text-gray-600 rounded-r px-4 py-3">
</div>

<div class="flex gap-3 flex-col mb-3">
  <p class="text-gray-600 font-semibold text-center">Ordenar por</p>
  <div class="flex gap-3 justify-evenly max-w-full overflow-x-auto">
    <button class="px-4 py-3 rounded bg-blue-100" (click)="sortrequests('created_at')">Fecha de creación</button>
    <button class="px-4 py-3 rounded bg-gray-100" (click)="sortRequests('entry_date')">Fecha de entrega</button>
    <button class="px-4 py-3 rounded bg-gray-100" (click)="sortRequests('devolution_date')">Fecha de devolución</button>
    <button class="px-4 py-3 rounded bg-gray-100" (click)="sortRequests('entry_city')">Ciudad</button>
  </div>
</div> -->

@if(userRole === Role.ADMIN){
  <div *ngFor="let paginatedRequest of paginatedRequestsForAdmin" class="bg-gray-100 hover:bg-gray-200 w-full shadow-md rounded-t-md flex-col mb-3">
    <div class="flex gap-4 justify-evenly items-center p-3" (click)="toggleModal('details', paginatedRequest.id)">
      <div class="flex text-center bg-gray-800 p-1 rounded items-center">
        <p class="text-gray-100 text-sm vertical-text">{{ paginatedRequest.name.split(" ")[0] }}</p>
        <p class="text-gray-100 text-xs vertical-text">{{ paginatedRequest.created_at | date : 'dd/MM/yyyy' }}</p>
      </div>
      <ul class="m-0 p-0 text-gray-600 text-sm">
        <li><strong>Gama: </strong>{{ paginatedRequest.gamma }}</li>
        <li><strong>Caja: </strong>{{ paginatedRequest.transmission }}</li>
        <li><strong>Días de renta: </strong>{{ paginatedRequest.days_of_rent }}</li>
        <li><strong>Entrega: </strong>{{ paginatedRequest.entry_city + ' ' + paginatedRequest.receive_at_airport }}<br>{{ paginatedRequest.entry_date + ', ' + paginatedRequest.entry_time }}</li>
        <li><strong>Devolución: </strong>{{ paginatedRequest.devolution_city + ' ' + paginatedRequest.returns_at_airport }}<br>{{ paginatedRequest.devolution_date + ', ' + paginatedRequest.devolution_time }}</li>
      </ul>
      <span class="text-gray-800 font-extrabold p-3 bg-gray-200 hover:bg-gray-300 rounded-md">></span>
    </div>
    <div class="w-full flex justify-between">
      <button [disabled]="paginatedRequest.sent_to.length === 0" [ngClass]="paginatedRequest.sent_to.length === 0 ? 'bg-gray-300 text-gray-700' : 'bg-blue-400 hover:bg-blue-500 text-gray-100'" class="p-2 w-1/3 rounded-l" (click)="ejecutarAccion('sent_to', paginatedRequest.id)"><fa-icon [icon]="faPaperPlane"></fa-icon> {{ paginatedRequest.sent_to.length }}</button>
      <button [disabled]="paginatedRequest.quotes.length === 0" [ngClass]="paginatedRequest.quotes.length === 0 ? 'bg-gray-300 text-gray-700' : 'bg-green-400 hover:bg-green-500 text-gray-100'" class="p-2 w-1/3" (click)="ejecutarAccion('view_quotes', paginatedRequest.id)"><fa-icon [icon]="faCheck"></fa-icon> {{ paginatedRequest.quotes.length }}</button>
      <button [disabled]="paginatedRequest.answers.length === 0" [ngClass]="paginatedRequest.answers.length === 0 ? 'bg-gray-300 text-gray-700' : 'bg-red-400 hover:bg-red-500 text-gray-100'" class="p-2 w-1/3 rounded-r" (click)="ejecutarAccion('view_answers', paginatedRequest.id)"><fa-icon [icon]="faFrown"></fa-icon> {{ paginatedRequest.answers.length }}</button>
    </div>
  </div>
}@else if(userRole === Role.PROVIDER){
  <div *ngFor="let paginatedRequest of paginatedRequestsForProvider" class="bg-gray-100 hover:bg-gray-200 w-full shadow-md rounded-t-md flex-col mb-3">
    <div class="flex gap-4 justify-evenly items-center p-3" (click)="toggleModal('details', paginatedRequest.id)">
      <p class="text-gray-100 text-xs vertical-text rounded p-1 bg-gray-800">{{ paginatedRequest.created_at | date : 'dd/MM/yyyy' }}</p>
      <ul class="m-0 p-0 text-gray-600 text-sm">
        <li><strong>Gama: </strong>{{ paginatedRequest.gamma }}</li>
        <li><strong>Caja: </strong>{{ paginatedRequest.transmission }}</li>
        <li><strong>Días de renta: </strong>{{ paginatedRequest.days_of_rent }}</li>
        <li><strong>Entrega: </strong>{{ paginatedRequest.entry_city + ' ' + paginatedRequest.receive_at_airport }}<br>{{ paginatedRequest.entry_date + ', ' + paginatedRequest.entry_time }}</li>
        <li><strong>Devolución: </strong>{{ paginatedRequest.devolution_city + ' ' + paginatedRequest.returns_at_airport }}<br>{{ paginatedRequest.devolution_date + ', ' + paginatedRequest.devolution_time }}</li>
      </ul>
      <span class="text-gray-800 font-extrabold p-3 bg-gray-200 hover:bg-gray-300 rounded-md">></span>
    </div>
    <div class="w-full" [ngSwitch]="hasQuoteOrAnswer(paginatedRequest.id)">
      <div class="flex w-full" *ngSwitchCase="'no'">
        <button (click)="ejecutarAccion('quote', paginatedRequest.id)" class="bg-green-400 hover:bg-green-500 py-2 rounded-l-md w-4/5">
          <p class="text-gray-100 font-extrabold text-center">Cotizar</p>
        </button>
        <button (click)="mostrarOverlay($event, 'splitbutton', paginatedRequest.id)" class="w-1/5 rounded-r-md text-center bg-green-500 hover:bg-green-600">
          <fa-icon [icon]="faCaretDown"></fa-icon>
        </button>
      </div>
      <div *ngSwitchCase="'Agotado'" class="text-red-400 py-2 rounded-b-md">
        <p class="font-extrabold text-center">Agotado</p>
      </div>
      <div *ngSwitchCase="'No es mi categoría'" class="text-yellow-400 py-2 rounded-b-md">
        <p class="font-extrabold text-center text-sm">No es mi categoría</p>
      </div>
      <div *ngSwitchCase="'Cotizado'" class="text-blue-400 py-2 rounded-b-md">
        <p class="font-extrabold text-center">Ya cotizado</p>
      </div>
      <div *ngSwitchCase="'Expirado'" class="text-gray-500 py-2 rounded-b-md">
        <p class="font-extrabold text-center">Expirado</p>
      </div>
    </div>
  </div>
}

<div class="flex items-center mt-4 overflow-x-auto">
  <!-- Botón Anterior -->
  <button
    class="text-sm px-4 py-2 mx-1 bg-gray-300 hover:bg-gray-400 rounded"
    (click)="changePage(currentPage - 1)"
    [disabled]="currentPage === 1">
    <fa-icon [icon]="faCaretLeft"></fa-icon>
  </button>

  <!-- Mostrar siempre la primera página -->
  <button
    class="px-3 py-1 mx-1 rounded"
    *ngIf="currentPage >= 4"
    [ngClass]="{ 'bg-blue-500 text-white': currentPage === 1, 'bg-gray-200': currentPage != 1 }"
    (click)="changePage(1)">
    1
  </button>

  <!-- Mostrar puntos suspensivos antes del rango visible -->
  <span *ngIf="visiblePages[0] > 2" class="px-2">...</span>

  <!-- Páginas visibles -->
  <span *ngFor="let page of visiblePages" class="px-2">
    <button
      class="px-3 py-1 mx-1 rounded"
      [ngClass]="{ 'bg-blue-500 text-white': currentPage === page, 'bg-gray-200': currentPage != page }"
      (click)="changePage(page)">
      {{ page }}
    </button>
  </span>

  <!-- Mostrar puntos suspensivos después del rango visible -->
  <span *ngIf="visiblePages[visiblePages.length - 1] < totalPages - 1" class="px-2">...</span>

  <!-- Mostrar siempre la última página -->
  <button
    class="px-3 py-1 mx-1 rounded"
    *ngIf="currentPage <= 21"
    [ngClass]="{ 'bg-blue-500 text-white': currentPage === totalPages, 'bg-gray-200': currentPage != totalPages }"
    (click)="changePage(totalPages)">
    {{ totalPages }}
  </button>

  <!-- Botón Siguiente -->
  <button
    class="text-sm px-4 py-2 mx-1 bg-gray-300 hover:bg-gray-400 rounded"
    (click)="changePage(currentPage + 1)"
    [disabled]="currentPage === totalPages">
    <fa-icon [icon]="faCaretRight"></fa-icon>
  </button>
</div>

<div
*ngIf="isDetailsModalVisible"
  class="fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center"
  style="z-index: 5"
>
  <!-- Contenedor del Modal -->
  <div
    class="bg-white rounded-lg shadow-lg w-lg w-full  px-6 py-8 relative overflow-y-auto"
    style="max-height: 95%; width: 500px;"
  >
    <!-- Botón de Cerrar -->
    <button
      style="z-index: 2"
      class="absolute top-0 right-0 mt-4 mr-4 text-gray-500 hover:text-gray-700"
      (click)="toggleModal('details')"
    >
      ✖️
    </button>
    <h1 class="text-center text-2xl font-extrabold text-gray-700 mb-5">Detalles de Solicitud</h1>
    <ul class="p-0 mb-3 text-gray-600">
      <li><strong>ID:</strong> {{ requestDetails.id }}</li>
      <li *ngIf="userRole === Role.ADMIN"><strong>Enviado a: </strong> <button [disabled]="requestDetails.sent_to === 0" [ngClass]="requestDetails.sent_to === 0 ? 'text-gray-600' : 'text-blue-400 hover:bg-blue-500 hover:text-gray-100'" class="p-2 rounded" (click)="ejecutarAccion('sent_to', requestDetails.id)">{{ requestDetails.sent_to }}</button></li>
      <li *ngIf="userRole === Role.ADMIN"><strong>Cotizaciones: </strong> <button [disabled]="requestDetails.quotes === 0" [ngClass]="requestDetails.quotes === 0 ? 'text-gray-600' : 'text-green-400 hover:bg-green-500 hover:text-gray-100'" class="p-2 rounded" (click)="ejecutarAccion('view_quotes', requestDetails.id)">{{ requestDetails.quotes }}</button></li>
      <li *ngIf="userRole === Role.ADMIN"><strong>Otras respuestas: </strong> <button [disabled]="requestDetails.answers === 0" [ngClass]="requestDetails.answers === 0 ? 'text-gray-600' : 'text-red-400 hover:bg-red-500 hover:text-gray-100'" class="p-2 rounded" (click)="ejecutarAccion('view_answers', requestDetails.id)">{{ requestDetails.answers }}</button></li>
      <li><strong>Fecha de creación:</strong> {{ requestDetails.created_at | date : "dd/MM/yyyy HH:mm" }}</li>
      <div class="flex items-center justify-center my-4" *ngIf="userRole === Role.ADMIN">
        <div class="border-t border-dotted flex-grow border-gray-400"></div>
        <span class="mx-4 font-bold text-gray-400" title="Valores">
          Contacto
        </span>
        <div class="border-t border-dotted flex-grow border-gray-400"></div>
      </div>
      <li *ngIf="userRole === Role.ADMIN"><strong>Nombre:</strong> {{ requestDetails.name }}</li>
      <li *ngIf="userRole === Role.ADMIN"><strong>Celular: </strong> <a class="!text-blue-400 hover:!text-blue-500" href="tel:{{ requestDetails.phone }}">{{ requestDetails.phone }}</a></li>
      <li *ngIf="userRole === Role.ADMIN"><strong>Email:</strong> {{ requestDetails.email || 'No aportado' }}</li>
      <div class="flex items-center justify-center my-4">
        <div class="border-t border-dotted flex-grow border-gray-400"></div>
        <span class="mx-4 font-bold text-gray-400" title="Valores">
          Detalles de solicitud
        </span>
        <div class="border-t border-dotted flex-grow border-gray-400"></div>
      </div>
      <li><strong>Gama:</strong> {{ requestDetails.gamma }}</li>
      <li><strong>Transmisión:</strong> {{ requestDetails.transmission }}</li>
      <li><strong>Días de renta:</strong> {{ requestDetails.days_of_rent }}</li>
      <li><strong>Ciudad de entrega:</strong> {{ requestDetails.entry_city + ' ' + requestDetails.receive_at_airport }}</li>
      <li><strong>Fecha de entrega:</strong> {{ requestDetails.entry_date | date : "dd/MM/yyyy" }} {{ requestDetails.entry_time }}</li>
      <li><strong>Ciudad de devolución:</strong> {{ requestDetails.devolution_city }}</li>
      <li><strong>Fecha de devolución:</strong> {{ requestDetails.devolution_date | date : 'dd/MM/yyyy' }} {{ requestDetails.devolution_time }}</li>
      <div class="flex items-center justify-center my-4">
        <div class="border-t border-dotted flex-grow border-gray-400"></div>
        <span class="mx-4 font-bold text-gray-400" title="Otros detalles">
          Otros detalles
        </span>
        <div class="border-t border-dotted flex-grow border-gray-400"></div>
      </div>
      <li><strong>Comentarios:</strong> {{ requestDetails.comments }}</li>
    </ul>
    <div class="flex gap-3 justify-end">
      <button class="bg-red-400 hover:bg-red-500 text-white px-4 py-2 rounded" *ngIf="userRole === Role.ADMIN"
      (click)="ejecutarAccion('delete', requestDetails.id)">
        Eliminar
      </button>
      <button
        class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded"
        (click)="toggleModal('details')"
      >
        Cerrar
      </button>
    </div>
  </div>
</div>
